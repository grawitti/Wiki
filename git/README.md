# Git. Описание команд<!-- vscode-markdown-toc -->

* [Основные команды](#0)
	* [Загрузка репозитория](#01)
	* [Загрузка новых изменений из репозитория](#02)
	* [Просмотр изменений](#03)
	* [Просмотр лога](#04)
	* [Сброс изменений](#05)
	* [Создание патча](#06)
	* [Применение патча](#07)
* [Коммит](#1)
	* [Создание](#-1)
	* [Переход между коммитами](#-1)
	* [Отмена изменений](#-1)
	* [Добавление изменений](#-1)
	* [Объединение](#-1)
* [Ветвление](#2)
	* [Просмотр доступных веток](#-1)
	* [Создание новой ветки](#-1)
	* [Добавление изменений в ветку](#-1)
	* [Слияние веток](#-1)
	* [Конфликт версий](#-1)
	* [Переименование ветки](#-1)
	* [Удаление ветки](#-1)
* [Модули](#3)
	* [Загрузка субмодулей](#-1)
	* [Обновление субмодулей](#-1)

<!-- vscode-markdown-toc-config
	numbering=false
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->

## <a name='0'></a>Основные команды

### <a name='01'></a>Загрузка репозитория

    git clone https://github.com/grawitti/Wiki

чтобы загрузить определённую ветку:

    git clone -b BRANCH https://github.com/grawitti/Wiki

*   `BRANCH` — название ветки в репозитории

### <a name='02'></a>Загрузка новых изменений из репозитория

    git pull

### <a name='03'></a>Просмотр изменений

    git status

Показывает три группы файлов:

*   **Changes to be committed** — файл помечен для добавления в коммит. Чтобы исключить файл из коммита:

        git reset HEAD [PATH]

*   **Changes not staged for commit** — файлы с изменениями. Изменения можно отменить [Сброс изменений](#checkout--) или пометить на добавление в коммит:

        git add [PATH]

*   **Untracked files** — файлы не добавленные в репозиторий. Чтобы добавить файл в репозиторий:

        git add [PATH]

### <a name='04'></a>Просмотр лога

    git log

Более красивый вариант с графом изменений:

    git log --graph --all --format=format:'%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n''          %C(white)%s%C(reset) %C(bold white)— %an%C(reset)' --abbrev-commit

### <a name='05'></a>Сброс изменений

    git checkout -- PATH

*   `PATH` — список файлов или каталогов в которых необходимо убрать изменения. Чтобы убрать все изменения необходимо указать текущий каталог: `git checkout -- .`

### <a name='06'></a>Создание патча

Патч – описание изменений в исходном коде. Как правило используется для тестирования, исправления ошибок или добавление нового функционала.

    git diff [PATH] >PATCH

*   `PATH` — список файлов или каталогов для добавления в патч
*   `PATCH` — путь для сохранения патча

### <a name='07'></a>Применение патча

    cat PATCH | patch -p1

Можно совместить загрузку и применение патча:

    wget -q -O - http://example.com/test.patch | patch -p1

или curl

    curl http://example.com/test.patch | patch -p1

## <a name='1'></a>Коммит

### <a name='-1'></a>Создание

**Коммит** — сохранённые изменения с описанием

**Важно!** изменение в коммитах можно выполнять только в локальном репозитории. Если коммиты были отправлены в общий репозиторий, то изменения вносить запрещено.

Добавление в коммит всех изменённых файлов:

    git commit -am "описание"

Файл не будет добавлен в коммит если он не относится к репозиторию - _в группе файлов "Untracked files". Подробней: [Просмотр изменений](#status)_. Чтобы добавить новый файл в репозиторий, необходимо выполнить команду: `git add [PATH]`

Добавление в коммит только определённых файлов:

    git commit -m "описание" [PATH]

### <a name='-1'></a>Переход между коммитами

Переход между коммитами:

    git checkout COMMIT

*   `COMMIT` — можно указать контрольную сумму коммита, название ветки (branch), название метки (tag)

### <a name='-1'></a>Отмена изменений

Отмена одного или нескольких коммитов с сохранением изменений

    git reset --soft COMMIT

*   `COMMIT` — может быть служебное слово `HEAD^` - отменить последний коммит. Колличество отменяемых коммитов зависит от количества повторений символа `^`, например отменить последних три коммита: `git reset --soft HEAD^^^`. Также можно указать контрольную сумму коммита, до которого отменить изменения, включительно

Отмена коммитов с удалением всех изменений:

    git reset --hard COMMIT

### <a name='-1'></a>Добавление изменений

Для изменения описания последнего коммита или добавления файлов в последний коммит:

    git commit --amend

При добавлении файлов, необходимо выполнить: `git add [PATH]` - пометить файл для добавления в коммит

### <a name='-1'></a>Объединение

Объединение нескольких коммитов в один:

    git rebase -i COMMIT

*   `COMMIT` — может быть служебное слово `HEAD^^` - объеденить два последних коммита. Колличество объединяемых коммитов зависит от количества повторений символа `^`. Также можно указать контрольную сумму коммита, до которого выполнить объединение, включительно

После запуска комманды появится редактор:

    pick 877a413 commit 4
    pick bb3031a commit 3
    pick ad64e80 commit 2
    pick ef43d0e commit 1
    ...

У первого коммита `877a413` остаётся команда `pick`, у остальных необходимо изменить команду на `squash`. После сохранения и выхода из редактора, запустится второй редактор, в нём будут перечислены описания объединямых коммитов, из них необходимо сформировать текст для нового коммита.

## <a name='-1'></a>Ветвление

### <a name='-1'></a>Просмотр доступных веток

**Ветка** или Бранч — группа коммитов. Ветвление удобно использовать для разработки нового функционала и командной разработки.

    git branch -a

Вывод команды:

    dev
    * master
    remotes/origin/feature

*   звёздочкой помечена текущая ветка
*   `master` и `dev` — ветки в локальном репозитории
*   `remotes/origin/feature` — ветка `feature` в удалённом репозитории `origin`

### <a name='-1'></a>Создание новой ветки

Создание ветки в локальном репозитории на основе ветки из удалённого репозитория:

    git checkout -tb BRANCH REMOTE

*   `-b` — создание новой ветки
*   `-t` — связать с веткой в удалённом репозитории
*   `BRANCH` — название ветки в локальном репозитории
*   `REMOTE` — название ветки в удалённом репозитории, например `remotes/origin/feature`

Создание ветки `custom` на основе локальной ветки `dev`:

    git checkout -b custom dev

При создании нового бранча происходит автоматическое переключение на него.

### <a name='-1'></a>Добавление изменений в ветку

Простой пример: в общую ветку `dev` были внесены изменения, эти изменения необходимо перенести в ветку `custom`

    git checkout dev
    git pull --rebase origin
    git checkout custom
    git rebase dev

1.  переключение в основной бранч
2.  получение изменений из основного репозитория
3.  переключение в бранч `custom`
4.  слияние изменений. При слиянии возможен [Конфликт версий](#conflict). **Важно!** `git rebase` можно использовать только для локальной ветки

### <a name='-1'></a>Слияние веток

    git checkout dev
    git merge --no-ff custom

1.  переключение в основной бранч
2.  слияние изменений. При слиянии возможен [Конфликт версий](#conflict)

Для слияния веток без создания коммита, необходимо указать параметр `--no-commit`. Можно использовать для исключения определённых файлов `PATH`. Например:

    git checkout dev
    git merge --no-ff --no-commit custom
    git checkout dev PATH
    git commit -a

### <a name='-1'></a>Конфликт версий

Если во время слияния происходит конфликт версий, выводится строка

    CONFLICT (content): Merge conflict in <file>

В файл будут внесена информаци о конфликтной ситуации. Например при слиянии веток `custom` и `dev`:

    <<<<<<< HEAD
    // Changes in dev branch
    =======
    // Changes in custom branch
    >>>>>>> foo version commit

Необходимо выбрать нужный кусок кода или доработать в соответствии с ситуацией. После редактирования:

    git add [PATH]
    git rebase --continue

1.  пометить файл
2.  продолжить слияние

### <a name='-1'></a>Переименование ветки

Переименование локальной ветки:

    git branch -m OLD-NAME NEW-NAME

Применение изменений в удалёном репозитории:

    git push origin :OLD-NAME
    git push origin NEW-NAME

1.  удалить старую ветку
2.  создать новую ветку

### <a name='-1'></a>Удаление ветки

Удалить ветку в локальном репозитории:

    git branch -d NAME

Удалить ветку в удалённом репозитории:

    git push origin :NAME

## <a name='-1'></a>Модули

### <a name='-1'></a>Загрузка субмодулей

    git submodule update --init --recursive

### <a name='-1'></a>Обновление субмодулей

    git submodule update --recursive --remote
