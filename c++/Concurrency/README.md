# Конспект книги С++ Практика многопоточного программирования 2 изд.

Автор: Энтони Уильямс
Год: 2020

## Глава 2 Управление потоками

Для создания потока необходимо включить заголовочник `<thread>` и создать объект
`std::thread` указав функцию для запуска в потоке:

```cpp
#include <thread>

void f()
{
    // do something...
}

int main()
{
    std::thread t(f); // run function f() into new thread
    t.join(); // join thread t
    return 0;
}
```

Если не ждать завершения созданного потока или не отсоеднить его деструктор `std::thread` вызовет `std::terminate()`.

Для того чтобы дождаться завершения потока можно вызвать метод потока `join()` и управляющий поток остановтся в ожидании завершения вызываемого потока.

Метод `join()` потока можно вызвать только один раз, если функция потока `joinable()` возвращает `true`.

При выбросе исключения может произойти так что `join` или `detach` не успеют быть зывваны что привет к проблемам, поэтому необходимо предусмотреть перехват `catch` с вызовом `join()`.

Можно так же создать клаcc `tread_guard` (листинг 2.3 стр. 50) в деструкотре которого быдет вызываться метод `join()`.

Вызов метода `detach()` для объекта `std::thread` позволяет потоку выполняться в фоновом режиме, непосредственное взаимодействие с ним не требуется. Возможность
дождаться завершения этого потока исчезает: если поток отсоединяется, получить ссылающийся на него объект `std::thread` невозможно, поэтому такой поток больше нельзя присоединить.

## Передача права владения потоком

`std::thread` поддерживает перемещение, с помошью `std::move` можно передавать право влядения потокам в другой объект `std::thread`:

```cpp
thread t1(f, 30, string("c2p3"));
thread t2 = move(t1);
t1 = thread(f, 31 , string("c2p3"));
thread t3;
t3=move(t2);
```

## Передача параметров функции потока

Для передачи параметров функции запускаемой в потоке необходимо передать параметры после указателя функции:

```cpp
void f(int i, string s);
std::thread t(f, 1, "text");
```

## Количество потоков в ходе выполнения программы

`std::thread::hardware_concurrency()` - возвращает то количество потоков, которые действительно могут работать одновременно в ходе выполнения
программы, пример: (листинг 2.9 стр. 60).

## Идентификация потоков

Получить идентификаторы потока можно 2 способами:
- Вызвав функцию `get_id()` объекта `std::thread`.
- Вызвав функцию `std::this_thread::get_id()`. 

