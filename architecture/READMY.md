# Архотектура ПО

## Виды архитектуры ПО
- монолит
- микросервис

### Характеристики архитектур ПО

#### Монолит
*Плюсы:*
- Простота интеграционного тестирования
- Сложность блочного тестирования
- Простота развертки

*Минусы:*
- Сложно масштабируется, если не заложили масштабируемость в архитектуру
- Плохая гибкость при изменении требований

#### Микросервис
*Плюсы:*
- Легко разрарабатывать при изменении требований
- Масштабируемость
- Легкость блочного тестирования

*Минусы:*
- сложность интеграционного тестирования
- сложнее развертывать


### Популярные шаблоны монолита

- *Model-View-Controller* (MVC, «Модель-Представление-Контроллер», «Модель-Вид-Контроллер») — схема разделения данных приложения и управляющей логики на три отдельных компонента: модель, представление и контроллер — таким образом, что модификация каждого компонента может осуществляться независимо.

    *Модель (Model)* предоставляет данные и реагирует на команды контроллера, изменяя своё состояние.
    *Представление (View)* отвечает за отображение данных модели пользователю, реагируя на изменения модели.
    *Контроллер (Controller)* интерпретирует действия пользователя, оповещая модель о необходимости изменений.

- *Model-View-Presenter (MVP)* — шаблон проектирования, производный от MVC, который используется в основном для построения пользовательского интерфейса.

    *Presenter* в данном шаблоне берёт на себя функциональность посредника (аналогично контроллеру вMVC) и отвечает за управление событиями пользовательского интерфейса (например, использование мыши) так же, как в других шаблонах обычно отвечает представление.

### Микросервис

    *Микросервис* – симметричная архитектура. Каждый сервис имеет свою базу и отвечает именно за бизнес-функцию (независимость от стека, масштабируемость, простота модульного тестирования).

## Виды взаимодействий между ПО

### Синхронное

    *Синхронные взаимодействия* это те взаимодействия, в которых одна система отправляет сообщение другой и ждет подтверждения или ответа, прежде чем продолжить работу.

### Асинхнонное

    *Асинхронные взаимодействия* - это те взаимодействия, в которых одна система отправляет сообщение другой и не ждет подтверждения или ответа, а продолжает работу.

## Виды интеграций

### Файловый обмен

Файловый обмен - асинхронный метод интеграции.

Данный метод интеграции появился достаточно давно и проверен временем. Смысл метода в том, что система номер 1 передает в систему номер 2 файл в установленном формате(например csv).

#### Плюсы данного подхода:
- Простота
- Отсутствие необходимости соединения между системами

#### Недостатки:
- Скорость
- Ненадежность
- Отсутствие возможности получить информацию о валидности файла со стороны вызывающей системы

### База к базе (или общая база данных)

Данный метод интеграции предполагает, что 2 приложения используют общую базу данных.

#### Плюс данного подхода:

- Простота

#### Недостаток:

- Подход создает сильную связанность между системами

Такой метод обмена является асинхронным, поскольку чаще всего подход database links работает в одном направлении и данные в системе-получателе появляются только по запросу, т.е создать, например триггер, который отправляет данные в другую базу данных при заданном событии не получится.

### Удалённый вызов

Идея данного метод интеграции в том, что система 1 удаленно вызывает метод системы 2, передавая туда нужные параметры. 

#### GRPC – opensource фреймворк для удаленного вызова процедур

*GRPC* - Remote procedure call первоначально разработанная google.
Все запросы в рамках GRPC строго типизированные, для их описания используются proto-файлы написаные на языке Interface Definituin Language (IDL). 

RPC позволяет реализовать как синхронное, так и асинхронное взаимодействие между сервисами.

GRPC server написанный на одном языке модет общаться с клиентами написанными на других языках.
GRPC используется поверх протокола HTTP/2. 
GRPC поддерживает сжатие данных, что улучшает скорость передачи данных.
GRPC поддерживает передачу данных потоком (стриминг).

#### SOAP - simple Object Access Protocol («простой протокол доступа к объектам»). 

##### Недостатки:
- SOAP поддерживает только SOAP-сообщения (сообщения, имеющие строго определенную структуру, в формате XML)
- SOAP достаточно громоздкий
- SOAP не поддерживает стриминговую передачу сообщений. Поэтому в SOAP всегда один запрос – один ответ.

SOAP может использоваться поверх протоколов SMTP, FTP, HTTP, HTTPS.

#### REST

*REST* - архитектурный стиль взаимодействия компонентов распределённого приложения в сети

##### Свойства REST:

- Производительность,
- Масштабируемость,
- Гибкость к изменениям,
- Отказоустойчивость,
- Простота поддержки.

##### 6  принципов REST:

- Клиент-серверная архитектура
- Stateless
- Кэширование
- Единообразие интерфейса
- Layered system
- Code on demand

###### Stateless

Принцип заключается в том, что сервер не должен хранить у себя информацию о сессии с клиентом. Он должен в каждом запросе получать всю информацию для обработки. 

Какие он даёт плюсы?

- Масштабируемость сервера,
- Уменьшение времени обработки запроса,
- Простота поддержки,
- Возможность использовать кэширование.

Какие проблемы может создать Stateless-подход?

- Усложнение логики клиента (именно на стороне клиента нам нужно хранить всю информацию о состоянии, о допустимых действиях, о недопустимых действиях и подобных вещах).
- Увеличение нагрузки на сеть (каждый раз мы передаём всю информацию, весь контекст. Таким образом, больше информации гоняем по сети).

###### Единообразие интерфейса. HATEOAS
*Hypermedia as the Engine of Application State (HATEOAS)* — одно из ограничений REST, согласно которому сервер возвращает не только ресурс, но и его связи с другими ресурсами и действия, которые можно с ним совершить.

###### Layered system (слоистая архитектура)
В предыдущих схемах мы рассматривали сторону клиента и сторону сервера, но не думали, что между ними могут быть посредники.

В реальной жизни между ними могут быть, к примеру, proxy-сервера, роутеры, балансировщики — все, что угодно. И то, по какому пути запрос проходит от клиента до сервера, мы часто не можем знать.

Концепция слоистой архитектуры заключается в том, что ни клиент, ни сервер не должны знать о том, как происходит цепочка вызовов дальше своих прямых соседей.

###### Code on done (код по требованию)
Идея передачи некоторого исполняемого кода (по сути какой-то программы) от сервера клиенту.
Например javascript.


#### Способы организации Микросервисной Архитектуры

##### Оркестрация

*Оркестрация служб* представляет собой единый централизованный исполняемый бизнес-процесс (оркестратор), который координирует взаимодействие между различными службами (например Camunda). Оркестратор отвечает за вызов и объединение служб.

Отношения между всеми участвующими службами описываются одной конечной точкой (т. е. составной службой). Оркестрация включает в себя управление транзакциями между отдельными службами и использует централизованный подход к составлению сервисов.

##### Хореография

*Хореография служб* - это глобальное описание участвующих служб, которое определяется обменом сообщениями, правилами взаимодействия и соглашениями между двумя или более конечными точками. Хореография использует децентрализованный подход к составлению сервисов.

Хореография описывает взаимодействие между несколькими службами, а оркестровка представляет контроль с точки зрения одной стороны. Это означает, что хореография отличается от оркестрации в отношении того, где должна находиться логика, управляющая взаимодействиями между задействованными сервисами.
